<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pizzeria Pub St. Sisinius</title>
    <style>



@keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

* {
    box-sizing: border-box;
}


/* Grunddesign f√ºr den Header */
.main-header {
    /*background-color: rgb(144, 41, 50);*/
	background-color: var(--red);
    color: white;
    padding: 15px;
    display: flex;
    align-items: center;
    border-bottom: none;
}

.main-header .logo {
    width: 100px; /* Etwas kleiner f√ºr mehr Platz */
    height: 100px;
    border: 2px solid white;
    object-fit: cover;
    border-radius: 50%;
    flex-shrink: 0;
}

.header-text {
    margin-left: 30px;
}

.header-text h1 {
    margin: 0;
    font-size: 1.6rem;
    line-height: 1.2;
    color: white;
    /* WICHTIG: Kein white-space: nowrap mehr! */
    white-space: normal !important; 
    overflow-wrap: break-word;
}

.header-text p {
    margin: 5px 0 0 0;
    font-size: 0.9rem;
    opacity: 0.9;
    letter-spacing: 1px;
}

/* HANDY-SPEZIALKORREKTUR */
@media (max-width: 600px) {
    .header-text h1 {
        font-size: 1.2rem !important; /* Kleinerer Text auf dem Handy */
    }
    .main-header .logo {
        width: 55px; /* Kleineres Logo spart Platz */
        height: 55px;
    }
}
	
	
	
	
footer { 
	position: relative; /* Nicht fixed, damit es am Ende der Seite mitscrollt */
	width: 100%; 
	background: #1a1a1a; 
	color: white; 
	padding: 30px 0; 
	border-top: 4px solid var(--red); 
	display: grid; 
	grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
	gap: 20px; 
	text-align: center; 
	font-size: 0.85rem; 
	line-height: 1.2 !important; /* Hier wird der Abstand eng gemacht */
}

.footer-section {
    display: block !important; /* Verhindert den flex-Abstand (gap) */
    margin-bottom: 10px;
}

.footer-section strong {
    display: block;
    margin-bottom: 4px;
    color: var(--white);
}

.footer-section a, 
.footer-section span {
    display: block;
    color: white;
    text-decoration: none;
    margin: 0 !important;
    padding: 0 !important;
    line-height: 1.2 !important; /* Garantiert den engen Abstand wie bei der Adresse */
}

footer a:hover {
    color: var(--red);
    text-decoration: underline;
}



footer {
    display: flex;
    flex-wrap: wrap; /* WICHTIG: Erlaubt das Umbrechen in die n√§chste Zeile */
    justify-content: space-between;
    padding: 20px;
}

.footer-bottom {
    flex-basis: 100%; /* Erzwingt, dass dieser Block die volle Breite einnimmt */
    margin-top: 20px;
    text-align: center;
}

.footer-divider {
    border: 0;
    border-top: 1px solid rgba(255,255,255,0.2);
    margin-bottom: 15px;
    width: 100%;
}

.copyright-text {
    color: white;
    font-size: 0.85rem;
    opacity: 0.7;
    margin: 0;
}
	
	
    /* Nur die Admin-Elemente standardm√§√üig ausblenden */
        .admin-only, .btn-ctrl, .admin-panel { 
            display: none !important; 
        }
        
        /* Nur einblenden, wenn die Klasse am body aktiv ist */
        body.admin-mode .admin-only, 
        body.admin-mode .btn-ctrl, 
        body.admin-mode .admin-panel { 
            display: block !important; 
        }
        
        /* Spezialfall f√ºr die Button-Reihe (Flex-Layout erhalten) */
        body.admin-mode .btn-row.admin-only {
            display: flex !important;
        }
        
       
:root { 
    --red: rgb(144, 41, 50); /* Dein neues dunkles Rot */
    --dark: #1a1a1a; 
    --light: #f4f4f4; 
    --white: #ffffff; 
}

/* Stelle sicher, dass die √úberschrift im Header keinen Schatten von alten Styles hat */
header h1 {
    text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
}

      .container { 
			max-width: 1100px; 
			width: 95%; /* Sorgt f√ºr einen kleinen Rand links/rechts auf dem Handy */
			margin: 20px auto; 
			padding: 0; 
		}

/* Verhindert, dass lange W√∂rter (wie Willkommen) am Handy rauswandern */
h1, h2, h3, p {
    overflow-wrap: break-word;
    word-wrap: break-word;
    max-width: 100%;
}


        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--light);}
        /*header { background: var(--white); padding: 15px 20px; display: flex; align-items: center; border-bottom: 4px solid var(--red); }*/        
       /* .logo { width: 70px; height: 70px; object-fit: cover; margin-right: 20px; border-radius: 50%; border: 2px solid var(--red);  margin-left:10%;}*/
        h1 { margin: 0; font-size: 1.6rem; }
        .nav-container { display: flex; justify-content: space-between; align-items: center; background: #222; padding: 5px 20px; position: sticky; top: 0; z-index: 1000;}
        .tabs { display: flex; flex-wrap: wrap;  margin-left:20%;}
        .tab-btn { background: none; border: none; color: white; cursor: pointer; padding: 12px 15px; font-weight: bold; text-transform: uppercase; font-size: 0.85rem; }
        .tab-btn.active { color: var(--red); border-bottom: 3px solid var(--red); }
        .lang-switch { display: flex; gap: 5px; }
        .lang-btn { background: #444; border: 1px solid #666; color: white; padding: 4px 10px; cursor: pointer; border-radius: 3px; }
        .lang-btn.active { background: var(--red); border-color: var(--red); }
    
        #content-area { display: grid; grid-template-columns: 1fr; gap: 20px; }
        @media (min-width: 850px) { #content-area.grid-mode { grid-template-columns: repeat(3, 1fr); } }
        @media (min-width: 850px) { #content-area.list-mode { grid-template-columns: 1fr; /* Nur eine Spalte = volle Breite */} }
        .entry { background: var(--white); border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: flex; flex-direction: column; border: 1px solid #ddd; }
        .entry-content { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; }
        .entry-header { display: flex; justify-content: space-between; font-weight: bold; font-size: 1.1rem; margin-bottom: 8px; }
        .price { color: var(--red); white-space: nowrap; margin-left: 10px; }
        .desc { font-size: 0.9rem; color: #555; font-style: italic; flex-grow: 1; }
        .item-img { width: 100%; height: 180px; object-fit: cover; }
        .admin-only { display: none; }
        body.admin-mode .admin-only { display: block; }
        .admin-panel { background: #eee; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 2px dashed #999; }
        .admin-panel div { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .admin-panel input { padding: 8px; border-radius: 4px; border: 1px solid #ccc; width: 100%; box-sizing: border-box; }
        .btn-row { display: flex; gap: 5px; margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee; }
        .btn-ctrl { padding: 5px 10px; cursor: pointer; border: none; border-radius: 3px; font-size: 0.8rem; background: #555; color: white; }
       
    /* Rahmen f√ºr das gesamte Event */
.event-card {
    border: 2px solid #8B4513;
    border-radius: 12px;
    margin-bottom: 25px;
    padding: 15px;
    background-color: #fffaf0; /* Cremiger Hintergrund */
}

/* Datum als √úberschrift */
.event-date {
    color: #8B4513;
    font-size: 1.4rem;
    font-weight: bold;
    text-align: center;
    margin-bottom: 5px;
}

/* Die braune Linie */
.event-line {
    border: none;
    height: 2px;
    background-color: #8B4513;
    margin-bottom: 15px;
}

/* 3-Spalten-Layout */
.event-grid {
    display: grid;
    grid-template-columns: 80px 1fr 100px; /* Zeit, Teams, League */
    gap: 15px;
    align-items: center;
    font-size: 1.1rem;
}

.event-time {
    color: #8B4513;
    font-weight: bold;
}

.event-teams {
    font-weight: bold;
    color: #333;
}

.event-league {
    text-align: right;
    font-style: italic;
    color: #666;
    font-size: 0.9rem;
}




        /* HERO SECTION */
.hero {
    position: relative;
    height: 450px;
    width: 100%;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    text-align: center;
}

.hero-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 1;
}

.hero-overlay {
    position: relative;
    z-index: 2;
    background: rgba(0, 0, 0, 0.5);
    padding: 1.5rem; /* Etwas weniger Padding spart Platz */
    border-radius: 10px;
    backdrop-filter: blur(3px);
    max-width: 90%; /* Erh√∂ht auf 90%, damit mehr Text in eine Zeile passt */
    box-sizing: border-box; /* Verhindert, dass Padding den Kasten sprengt */
}

.hero-overlay h2 {
    font-size: 2.5rem;
    margin: 0;
    text-transform: none; /* 'uppercase' macht W√∂rter oft zu breit f√ºr das Handy */
    overflow-wrap: break-word; /* Erzwingt den Umbruch bei langen W√∂rtern */
    word-wrap: break-word;
    line-height: 1.2;
}

/* --- ABOUT SECTION (Bild & Text) --- */
.about-section {
    display: flex;
    flex-direction: column; /* Standard f√ºr Handy: Untereinander */
    align-items: center;
    gap: 30px;
    background: white;
    padding: 30px;
    border-radius: 15px;
    margin: 40px 0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    box-sizing: border-box;
    width: 100%;
}

.about-image {
    width: 100%;
    max-width: 300px;
    height: auto;
    border-radius: 10px;
    object-fit: cover;
    flex-shrink: 0;
}

.about-text {
    flex: 1;
    color: #333;
    text-align: center; /* Handy: Zentriert */
}

/* WICHTIG: Entfernt den Abstand oberhalb des ersten Absatzes */
.about-text p:first-child {
    margin-top: 0 !important;
}

.about-text p {
    font-size: 1.1rem;
    line-height: 1.6;
    margin-bottom: 15px;
}

/* PC-ANPASSUNG (Ab 850px) */
@media (min-width: 850px) {
    .about-section {
        flex-direction: row !important; /* Bild links, Text rechts */
        align-items: flex-start !important; /* Text beginnt ganz oben b√ºndig mit Bild */
        text-align: left !important;
    }

    .about-text {
        text-align: left !important;
        padding-top: 0 !important;
    }
}

/* --- INFO CARDS (Kontakt & √ñffnungszeiten) --- */
.info-section-compact {
    display: grid;
    grid-template-columns: 1fr 1.2fr;
    gap: 25px;
    margin-top: 40px;
}

/* Erkennt "Ruhetag", "ruhetag" und "RUHETAG" f√ºr die italienische √úbersetzung */
html[lang="it"] .zeit-spalte[data-wert="Ruhetag" i]::after {
    content: "Giorno di riposo";
}

/* 1. Standard-Anzeige f√ºr Deutsch */
html[lang="de"] .zeit-spalte::after {
    content: attr(data-wert);
}

/* 2. Spezial-Regel f√ºr Italienisch: Wenn NICHT "Ruhetag" drinsteht (also eine Uhrzeit) */
html[lang="it"] .zeit-spalte::after {
    content: attr(data-wert);
}

/* 3. DIE √úBERSETZUNG: Wenn exakt "Ruhetag" im Attribut steht und Sprache Italienisch ist */
html[lang="it"] .zeit-spalte[data-wert="Ruhetag"]::after {
    content: "Giorno di riposo";
}



.contact-card-large, .hours-card-large {
    background: white;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    text-align: center;
    border-top: 5px solid var(--red);
}

.contact-icon, .hours-icon {
    font-size: 2.5rem;
    margin-bottom: 15px;
}

.phone-number {
    font-size: 1.5rem;
    color: var(--red);
    text-decoration: none;
    font-weight: bold;
    display: block;
    margin: 15px 0;
}

.hours-list {
    margin: 20px 0; /* Sorgt f√ºr vertikalen Abstand */
    padding: 0;     /* Verhindert ungewollte Einr√ºckungen */
    width: 100%;    /* Nutzt die volle Breite der Karte */
}

/* Die Zeile als Ganzes */
.hours-item {
    display: flex;
    justify-content: space-between;
    align-items: center; /* Zentriert Text vertikal */
    padding: 8px 0;
    border-bottom: 1px solid #eee;
    font-size: 1rem;
	gap: 10px; /* Kleiner Abstand zwischen Tag und Zeit */
}

/* Der Wochentag (links) */
.tag-spalte {
    flex: 0 0 100px; /* Der Tag hat eine feste Basisbreite */
	text-align: left;
    font-weight: bold;
    color: var(--dark);
}

/* Die Zeit-Spalte (rechts) */
.zeit-spalte {
    /* Nutzt eine feste Breite f√ºr alle Zahlen-Bl√∂cke */
    margin-left: auto; /* SCHIEBT DIE ZEIT NACH RECHTS */
	min-width: 140px; 
    text-align: right;
    /* Monospace sorgt daf√ºr, dass die '1' genau so breit ist wie die '0' */
    font-family: 'Courier New', Courier, monospace; 
    color: var(--red);
    white-space: nowrap; /* Verhindert Umbruch innerhalb der Uhrzeit */
}



.hours-item:last-child { border-bottom: none; }

/* Admin-Buttons Box */
.admin-btns-row {
    display: flex;
    gap: 4px;
    margin-left: 15px; /* Abstand zur Zeit-Spalte */
    flex-shrink: 0;   /* Buttons d√ºrfen nicht schrumpfen */
}

.admin-btns-row button {
    padding: 4px 8px;
    cursor: pointer;
    background: #f0f0f0;
    border: 1px solid #ccc;
    border-radius: 3px;
    font-size: 0.8rem;
}



/* --- FINALE HANDY-ANPASSUNG (max-width: 850px) --- */
@media (max-width: 850px) {
    /* 1. Container & Scroll-Schutz */
    .container { 
        width: 95% !important; 
        max-width: 100% !important;
        margin: 10px auto !important;
        overflow-x: hidden !important; 
    }

    /* 2. Startseite: Bild und Text untereinander */
    .about-section { flex-direction: column !important; padding: 20px !important; text-align: center !important; }
    .about-image { width: 100% !important; max-width: 320px !important; height: auto !important; }

    /* 4. FIX F√úR "WILLKOMMEN" & "LAAS - VINSCHGAU" */
    .hero-overlay {
        width: 92% !important;
        max-width: 92% !important;
        padding: 15px 10px !important;
        /*left: 50% !important;
        transform: translateX(-50%) !important;*/
        box-sizing: border-box !important;
        position: relative !important; /* Wichtig f√ºr das Zentrieren */
    }

    .hero-overlay h2 { 
        font-size: 1.5rem !important; 
        line-height: 1.2 !important;
        white-space: normal !important; 
        word-break: break-word !important; 
        overflow-wrap: break-word !important;
        hyphens: auto !important; 
        display: block !important;
        width: 100% !important;
        margin: 0 auto !important;
        text-transform: none !important; /* 'uppercase' braucht zu viel Platz */
    }
    
    .hero-overlay p { 
        font-size: 1.0rem !important; 
        white-space: normal !important;
        margin-top: 10px !important;
    }

    /* 5. Kontakt & √ñffnungszeiten */
    .info-section-compact { grid-template-columns: 1fr !important; }

    /* 6. TV-Events einspaltig */
    .event-grid { grid-template-columns: 1fr !important; text-align: center !important; }
}
@media (max-width: 600px) {
    .hours-item {
        flex-wrap: wrap; /* Erlaubt den Umbruch, falls es zu eng wird */
        justify-content: space-between;
        gap: 5px;
    }

    .tag-spalte {
        flex: 1 1 auto; /* Tag nimmt Platz ein, schiebt Rest nach rechts */
        font-size: 0.9rem;
    }

    .zeit-spalte {
        min-width: auto; /* Hebt die starre Breite auf */
        margin-left: auto;
        font-size: 0.9rem;
        text-align: right;
    }

@media (max-width: 600px) {
    /* Stapelt Zeit, Teams und Liga untereinander, damit nichts rechts rausragt */
    .event-grid {
        grid-template-columns: 1fr !important; 
        gap: 5px;
        text-align: center;
    }
    
    .event-time {
        color: var(--red);
        font-size: 1.1rem;
    }

    .event-league {
        text-align: center !important;
        font-style: normal;
        font-weight: bold;
        background: #eee; /* Kleine optische Trennung */
        border-radius: 4px;
        padding: 2px 0;
    }
}


</style>
</head>
<body>
    
<header class="main-header">
    <img src="logo.webp" class="logo" alt="Logo">
    <div class="header-text">
        <h1>Pizzeria Pub St. Sisinius</h1>
		<p id="ort">Laas - Vinschgau</p>	
    </div>
</header>
    
<div class="nav-container">
    <div class="tabs">
        <button class="tab-btn active" id="tab-start" onclick="setTab('start')">Start</button>
        <button class="tab-btn" id="tab-pizzas" onclick="setTab('pizzas')">Pizzakarte</button>
        <button class="tab-btn" id="tab-events" onclick="setTab('events')">Events</button>
        <button class="tab-btn" id="tab-tv" onclick="setTab('tv')">TV-Sport</button>
    </div>
    <div class="lang-switch">
        <button class="lang-btn active" id="btn-de" onclick="setLang('DE')">DE</button>
        <button class="lang-btn" id="btn-it" onclick="setLang('IT')">IT</button>
    </div>
</div>

<div class="container">
    <div id="content-area"></div>
</div>
    
<footer>
    <div class="footer-section">
        <strong>Pizzeria Pub St. Sisinius</strong>
        <span id="footer-address">Vinschgaustra√üe 74, 39023 Laas (BZ)</span>
        <span id="footer-region">S√ºdtirol, Italien)</span>
    </div>
    
    <div class="footer-section">
        <strong id="footer-contact">Kontakt</strong>
        <a href="tel:+393898334004">Tel: +39 389 833 4004</a>
        <span style="opacity: 0.8; font-size: 0.8rem;">P.IVA / MwSt.-Nr.: 03317990210</span>
    </div>

    <div class="footer-section">
        <strong id="footer-rechtliches">Rechtliches</strong>
        <a href="impressumDe.html" id="footer-impressum-link">Impressum / Note Legali</a>
        <a href="datenschutzDe.html" id="footer-datenschutz-link">Datenschutz / Privacy</a>
    </div>
	  <!-- Trennlinie und Copyright -->
    <!-- Diese Box erzwingt eine neue Zeile -->
    <div class="footer-bottom">
        <hr class="footer-divider">
        <p class="copyright-text">
            &copy; 2026 Pizzeria Pub St. Sisinius. Alle Rechte vorbehalten.
        </p>
    </div>
	
</footer>

<script>
 



function renderNoticePopup(data, lang, container) {
    if (!data.notice || !data.notice.active || sessionStorage.getItem('noticeSeen')) {
        return;
    }

    const title = lang === 'DE' ? (data.notice.titleDE || 'Wichtige Info') : (data.notice.titleIT || 'Info importante');
    const scrollHint = lang === 'DE' ? 'Mehr lesen' : 'Leggi di pi√π';
    
    let rawText = (lang === 'DE' ? data.notice.textDE : data.notice.textIT) || "";
    const formattedText = rawText
        .replace(/\n/g, '<br>') 
        .replace(/%25|%/g, '<div style="display:block; width:80%; height:2px; background-color:#ddd; margin:15px auto; border-radius:2px;"></div>');

    container.innerHTML += `
        <style>
            @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-5px);} 60% {transform: translateY(-3px);} }
            .scroll-hint { 
                position: absolute; bottom: 100px; right: 25px; 
                background: white; padding: 8px 12px; border-radius: 20px; 
                font-size: 13px; color: var(--red); font-weight: bold; 
                box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
                cursor: pointer; display: flex; align-items: center; gap: 5px; 
                animation: bounce 2s infinite; z-index: 11000; 
                border: 2px solid var(--red); transition: opacity 0.3s, transform 0.2s;
                user-select: none;
            }
            .scroll-hint:active { transform: scale(0.95); }
        </style>

        <div id="notice-popup" style="position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.85); display:flex; align-items:center; justify-content:center; z-index:10000; padding:20px; animation: fadeIn 0.3s ease-out;">
            
            <div style="background:white; border-radius:15px; max-width:450px; width:100%; max-height:90vh; text-align:center; border:4px solid var(--red); box-shadow: 0 10px 30px rgba(0,0,0,0.5); overflow:hidden; display:flex; flex-direction:column; position: relative;">
                
                <!-- SCROLL-HINWEIS (Anklickbar) -->
                <div id="popup-scroll-hint" class="scroll-hint" onclick="document.getElementById('popup-scroll-content').scrollBy({top: 150, behavior: 'smooth'})">
                    ${scrollHint} <span style="font-size: 16px;">‚Üì</span>
                </div>

                <!-- HEADER -->
                <div style="padding:20px 20px 10px 20px; flex-shrink:0; background: white; z-index: 10;">
                    <h2 style="color:var(--red); margin:0;">${title}</h2>
                </div>

                <!-- SCROLL-BEREICH -->
                <div id="popup-scroll-content" 
                     onscroll="if(this.scrollTop > 50) document.getElementById('popup-scroll-hint').style.opacity='0';" 
                     style="overflow-y:auto; flex-grow:1; padding:0 25px; scroll-behavior: smooth;">
                    
                    ${data.notice.img ? `
                        <img src="${data.notice.img}" 
                             style="max-width:100%; max-height:45vh; object-fit:contain; display:block; margin:0 auto 15px; border-radius:8px;">
                    ` : '<div style="font-size:50px; margin-bottom:15px;">üì¢</div>'}
                    
                    <div style="font-size:1.1rem; color:#333; font-weight:bold; line-height:1.5; text-align:center; padding-bottom:40px;">
                        ${formattedText}
                    </div>
                </div>

                <!-- FOOTER -->
                <div style="padding:15px 20px 25px 20px; flex-shrink:0; border-top:1px solid #eee; background: white; z-index: 10;">
                    <button onclick="closeNoticePopup()" style="background:var(--red); color:white; border:none; padding:12px 30px; border-radius:5px; font-weight:bold; cursor:pointer; text-transform:uppercase; width:100%;">
                        OK
                    </button>
                </div>
            </div>
        </div>
    `;
}









 
let editIndex = null; // Speichert, welche Position gerade bearbeitet wird
let data = { start: {}, pizzas: [], events: [], tv: [] };
let currentTab = 'start';
let lang = 'DE';
const editMode = btoa(new URLSearchParams(window.location.search).get('pw')) === 'bGVvbjIyMDg=';  //Base64-Code
if(editMode) document.body.classList.add('admin-mode');

//√ñFFNUNGSZEITEN 
//========================================
// ZEILE L√ñSCHEN
function deleteTime(index) {
    if (confirm("M√∂chten Sie diese √ñffnungszeit wirklich l√∂schen?")) {
        // Entfernt das Element an der Position 'index'
        data.start.zeiten.splice(index, 1);
        saveHoursToDB(data.start.zeiten);
    }
}

// ZEILE VERSCHIEBEN (Richtung: -1 f√ºr hoch, 1 f√ºr runter)
function moveTime(index, direction) {
    const arr = data.start.zeiten;
    const newIndex = index + direction;

    // Pr√ºfen, ob Verschieben m√∂glich ist (nicht √ºber die Grenzen hinaus)
    if (newIndex >= 0 && newIndex < arr.length) {
        // Tauscht die beiden Elemente im Array aus
        const temp = arr[index];
        arr[index] = arr[newIndex];
        arr[newIndex] = temp;
        
        saveHoursToDB(arr);
    }
}

// EINZELNE ZEILE BEARBEITEN (‚úé)
async function editSingleTime(idx) {
    const z = data.start.zeiten[idx];
    const tDE = prompt("Tag DE:", z.tagDE || z.tag);
    const tIT = prompt("Giorno IT:", z.tagIT || z.tag);
    const uhr = prompt("Zeit:", z.zeit);

    if (tDE && tIT && uhr) {
        data.start.zeiten[idx] = { tagDE: tDE, tagIT: tIT, zeit: uhr };
        await save();
        render();
    }
}

//-----------------------------------------------------  
  
  

function editItem(idx) {
    const item = data[currentTab][idx];	

    // ... deine anderen Felder (Name, Desc) ...
    
    // NEU: L√§dt die Liga/Kategorie in das entsprechende Input-Feld
    const catInput = document.getElementById('inCat'); 
    if (catInput) {
        catInput.value = item.cat || ""; 
    }
  
  
    document.getElementById('inNameDE').value = item.nameDE || "";
    document.getElementById('inNameIT').value = item.nameIT || "";
    document.getElementById('inDescDE').value = item.descDE || "";
    document.getElementById('inDescIT').value = item.descIT || "";
    document.getElementById('inRight').value = item.right || "";
    
	// 2. BILD-VORSCHAU AKTUALISIEREN (Der entscheidende Teil!)
    const preview = document.getElementById('img-preview');
    const hiddenInput = document.getElementById('inImgBase64');
    const noImgText = document.getElementById('no-img-text');

    if (item.img && item.img.length > 10) {
        // Falls ein Bild-Code in der MongoDB ist
        if (preview) {
            preview.src = item.img;
            preview.style.display = 'block';
        }
        if (hiddenInput) hiddenInput.value = item.img; // Code f√ºr sp√§teres Speichern vorhalten
        if (noImgText) noImgText.style.display = 'none';
    } else {
        // Falls kein Bild vorhanden ist
        if (preview) {
            preview.src = "";
            preview.style.display = 'none';
        }
        if (hiddenInput) hiddenInput.value = "";
        if (noImgText) noImgText.style.display = 'block';
    }

    editIndex = idx; // Position speichern!
    // 3. Titel und Scroll-Effekt
    const title = document.getElementById('admin-title');
    if (title) title.innerText = "Eintrag bearbeiten (Position: " + (idx + 1) + ")";
    window.scrollTo({ top: 0, behavior: 'smooth' });
}   
    

    
async function load() {
	try {
		const res = await fetch('/api/data?pw=leon2208');
		const fetchedData = await res.json();
		
		// Sicherstellen, dass 'data' immer die richtige Struktur hat
		data = fetchedData || {};
		if (!data.pizzas) data.pizzas = [];
		if (!data.events) data.events = [];
		if (!data.start) data.start = { img: 'lokal.webp', textDE: 'Willkommen', textIT: 'Benvenuti' };

		render(); // Jetzt wird die Seite garantiert gezeichnet
	} catch (e) {
		console.error("Fehler beim Laden der Daten:", e);
		// Notfall-Plan: Leere Struktur, damit die Seite nicht h√§ngen bleibt
		data = { start: { img: 'lokal.webp', textDE: 'Willkommen' }, pizzas: [], events: [] };
		render();
	}
}

/* async function save() {
	// Wenn wir auf 'start' sind, machen wir einfach gar nichts (da nichts zu √§ndern ist)
	if (currentTab === 'start') return; 
	await fetch('/api/data?pw=leon2208', {
		method: 'POST',
		headers: {'Content-Type': 'application/json'},
		body: JSON.stringify(data)
	});
	render();
}*/
	
	
async function save() {
    // Wir entfernen die Start-Sperre, damit auch √ñffnungszeiten gespeichert werden!
    try {
        const res = await fetch('/api/data?pw=leon2208', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });
        
        if (!res.ok) {
            alert("Fehler beim Speichern in der Cloud!");
        }
    } catch (e) {
        console.error("Speicherfehler:", e);
        alert("Verbindung zum Server fehlgeschlagen.");
    }
    // Wir rufen hier KEIN render() auf, das machen wir lieber in der 
    // aufrufenden Funktion (z.B. move oder addItem) nach dem await.
}

function setTab(t) { 
	currentTab = t; 
	document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.id === 'tab-'+t));
	render(); 
}

function setLang(l) { 
	lang = l; 
	
	// 2. WICHTIG: Das 'Gesehen'-Flag f√ºr das Popup l√∂schen!
	// Dadurch wird das Popup beim n√§chsten render() wieder angezeigt.
	sessionStorage.removeItem('noticeSeen');
	
	
	 // Tab-Buttons √ºbersetzen
	const btnStart = document.getElementById('tab-start');
	const btnPizzas = document.getElementById('tab-pizzas');
	const btnEvents = document.getElementById('tab-events');
	const btnTV = document.getElementById('tab-tv');

    if (lang === 'DE') {
        if(btnStart) btnStart.innerText = "Start";
        if(btnPizzas) btnPizzas.innerText = "Pizzakarte";
        if(btnEvents) btnEvents.innerText = "Events";
        if(btnTV) btnTV.innerText = "TV-Sport";
    } else {
        if(btnStart) btnStart.innerText = "Inizio";
        if(btnPizzas) btnPizzas.innerText = "Menu Pizza";
        if(btnEvents) btnEvents.innerText = "Eventi";
        if(btnTV) btnTV.innerText = "Sport TV";
    }
     
    const ort=document.getElementById('ort');
    if (lang === 'DE') {
        if (ort) {
            ort.innerHTML = "Laas - Vinschagau";
        }
	}
	else{
	    if (ort) {
		    ort.innerHTML = "Lasa - Venosta";
		}
	}
	
	
    // Footer-Elemente √ºbersetzen
    const footerHours = document.getElementById('footer-hours');
    const footerAddress = document.getElementById('footer-address');
    
    if (lang === 'DE') {
        if (footerHours) {
            footerHours.innerHTML = "Montag Ruhetag<br>Di-Do: 16:00-00:00<br>Fr-So: 16:00-01:00";
        }
        // Adresse (optional, falls "Vinschgaustra√üe" √ºbersetzt werden soll)
        if (footerAddress) footerAddress.innerText = "Vinschgaustra√üe 74, 39023 Laas (BZ)";
    } else {
        if (footerHours) {
            footerHours.innerHTML = "Luned√¨ giorno di riposo<br>Mar-Gio: 16:00-00:00<br>Ven-Dom: 16:00-01:00";
        }
        if (footerAddress) footerAddress.innerText = "Via Venosta 74, 39023 Lasa (BZ)";
    }
       
	document.getElementById('btn-de').classList.toggle('active', l==='DE');
	document.getElementById('btn-it').classList.toggle('active', l==='IT');
	render(); 
}

function render() {    
	// --- AUTOMATISCHE SORTIERUNG ---
	if (currentTab === 'tv' || currentTab === 'events') {
		data[currentTab].sort((a, b) => {
			let dateStrA, timeStrA, dateStrB, timeStrB;

			if (currentTab === 'tv') {
				// TV: Datum in descDE, Zeit in right
				dateStrA = a.descDE; timeStrA = a.right;
				dateStrB = b.descDE; timeStrB = b.right;
			} else {
				// EVENTS: Datum in right (z.B. "Fr 13.02.26"), Zeit meist in descDE oder gar nicht
				dateStrA = a.right; timeStrA = "00:00"; 
				dateStrB = b.right; timeStrB = "00:00";
			}

			const dA = parseSisiniusDate(dateStrA, timeStrA);
			const dB = parseSisiniusDate(dateStrB, timeStrB);
			return dA - dB;
		});
	}
	
	// --- FOOTER SPRACHUMSTELLUNG ---

	// 1. Elemente abgreifen
	const footerAddr = document.getElementById('footer-address');
	const footerRegion = document.getElementById('footer-region');
	const footerContact = document.getElementById('footer-contact');
	const footerRecht = document.getElementById('footer-rechtliches');
	const footerImpLink = document.getElementById('footer-impressum-link');
	const footerDataLink = document.getElementById('footer-datenschutz-link');

	// 2. Texte und Links je nach Sprache setzen
	if (lang === 'DE') {
		if (footerAddr) footerAddr.innerText = "Vinschgaustra√üe 74, 39023 Laas (BZ)";
		if (footerRegion) footerRegion.innerText = "S√ºdtirol, Italien";
		if (footerContact) footerContact.innerText = "Kontakt";
		if (footerRecht) footerRecht.innerText = "Rechtliches";
		
		if (footerImpLink) {
			footerImpLink.innerText = "Impressum";
			footerImpLink.href = "impressumDe.html";
		}
		if (footerDataLink) {
			footerDataLink.innerText = "Datenschutz";
			footerDataLink.href = "datenschutzDe.html";
		}
	} else {
		// ITALIENISCH (IT)
		if (footerAddr) footerAddr.innerText = "Via Venosta 74, 39023 Lasa (BZ)";
		if (footerRegion) footerRegion.innerText = "Alto Adige, Italia";
		if (footerContact) footerContact.innerText = "Contatto";
		if (footerRecht) footerRecht.innerText = "Informazioni legali";
		
		if (footerImpLink) {
			footerImpLink.innerText = "Note Legali"; // In Italien hei√üt Impressum oft Note Legali
			footerImpLink.href = "impressumIt.html";
		}
		if (footerDataLink) {
			footerDataLink.innerText = "Informativa sulla privacy";
			footerDataLink.href = "datenschutzIt.html";
		}
	}
	

	const area = document.getElementById('content-area');
    if (!area) return;
    area.innerHTML = '';

    // Admin-Modus Klasse am Body umschalten
    if (editMode) {
        document.body.classList.add('admin-mode');
    } else {
        document.body.classList.remove('admin-mode');
    }

	// 2.1. ADMIN-KONSOLE
	//-------------------------------
	if (editMode && currentTab !== 'start') {
		let label = currentTab === 'pizzas' ? 'Preis' : (currentTab === 'tv' ? 'Uhrzeit' : 'Datum');
		
		
		 // NEU: Platzhalter f√ºr Beschreibung je nach Tab (TV = Datum, Events = Uhrzeit, Rest = Beschreibung)
		let labelDesc = 'Beschreibung';
		let labelDescIT = 'Descrizione';
		
		if (currentTab === 'tv') {
			labelDesc = 'Datum (z.B. Freitag 13.02.26)';
			labelDescIT = 'Data (p.es. Venerd√¨ 13/02/26)';
		} else if (currentTab === 'events') {
			labelDesc = 'Uhrzeit (z.B. ab 20:00 Uhr)';
			labelDescIT = 'Orario (p.es. dalle ore 20:00)';
		}


		// Vor dem area.innerHTML += Block:
		let descITField = '';

		// Nur bei Pizzen brauchen wir das zweite Beschreibungsfeld (Zutaten IT)
		if (currentTab === 'pizzas') {
			descITField = `<input type="text" id="inDescIT" placeholder="Descrizione (IT)">`;
		} else {
			// Bei TV-Sport und Events nutzen wir die Automatik -> Feld verstecken
			descITField = `<input type="hidden" id="inDescIT" value="">`;
		}

		area.innerHTML += `
			<div class="admin-panel" style="display: block; margin-bottom: 20px; background: #f9f9f9; padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
				<strong id="admin-title" style="color: var(--red);">Admin-Konsole (${currentTab.toUpperCase()})</strong>
				
				<div class="input-grid" style="margin-top: 10px;">
					<input type="text" id="inNameDE" placeholder="Name/Titel (DE)">
					<input type="text" id="inNameIT" placeholder="Nome/Titolo (IT)">
					
					<!-- Hier werden die Platzhalter jetzt variabel genutzt -->
					<input type="text" id="inDescDE" placeholder="${labelDesc}">
					<!-- Hier wird nun das variable Feld eingesetzt -->
					${descITField}
					<input type="text" id="inRight" placeholder="${label}">
				</div>

				<!-- BILD-UPLOAD BEREICH -->
				<div style="margin-top: 15px; border: 1px dashed #ccc; padding: 10px; border-radius: 5px; background: white;">
					<label style="display:block; font-weight:bold; margin-bottom:5px; font-size: 0.9rem;">Bild f√ºr ${currentTab.toUpperCase()}:</label>
					
					<input type="file" id="inImgFile" accept="image/*" onchange="encodeImageFileAsURL(this)" style="width:100%; font-size: 0.8rem;">

					<div id="preview-box" style="margin-top: 10px; text-align: center; min-height: 50px;">
						<img id="img-preview" src="" style="max-height:120px; border-radius:5px; display:none; border:2px solid var(--red);">
						<p id="no-img-text" style="font-size: 0.8rem; color: #888; margin: 5px 0;">Kein Bild gew√§hlt</p>
					</div>

					<input type="hidden" id="inImgBase64">
					<div id="upload-status" style="font-size: 0.8rem; color: green; display: none; text-align: center;">‚úÖ Bild bereit!</div>
				</div>

				<!-- KATEGORIE-WAHL -->
				${(currentTab === 'pizzas' || currentTab === 'tv') ? `
					<div style="margin-top: 15px; background: #fff; padding: 10px; border-radius: 5px; border: 1px solid #eee;">
						<label style="font-weight: bold; font-size: 0.9rem;">${currentTab === 'pizzas' ? 'Pizza-Kategorie:' : 'Liga / Wettbewerb:'}</label>
						${currentTab === 'pizzas' ? `
							<select id="inCat" style="width:100%; padding:8px; margin-top:5px;">
								<option value="pizza">Standard Pizza</option>
								<option value="bianche">Pizza Bianche</option>
								<option value="kinder">Kinderpizza</option>
								<option value="extras">Extras</option>
							</select>
						` : `
							<input type="text" id="inCat" placeholder="z.B. Champions League" style="width:100%; padding:8px; margin-top:5px;">
						`}
					</div>
				` : ''}
				
				<div style="margin-top: 20px; display: flex; gap: 10px;">
					<button onclick="addItem()" style="flex: 1; background: #2e7d32; color: white; padding: 12px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">Eintrag speichern</button>
					<button onclick="location.reload()" style="flex: 1; background: #757575; color: white; padding: 12px; border: none; border-radius: 4px; cursor: pointer;">Abbrechen</button>
				</div>
			</div>
		`;
	
	}

    // 1. STARTSEITE (Sonderlayout)
	//=====================================
    if (currentTab === 'start') {
        const s = data.start || { 
            img: 'lokal.webp', 
            textDE: 'Willkommen bei Pizzeria Pub St. Sisinius', 
            textIT: 'Benvenuti alla Pizzeria Pub St. Sisinius' 
        };
        
		area.className = 'list-mode';
		
		area.innerHTML += `
			<div class="hero" style="
				height: 500px; 
				position: relative; 
				width: 100vw; 
				left: 50%; 
				right: 50%; 
				margin-left: -50vw; 
				margin-right: -50vw; 
				overflow: hidden; 
				display: flex; 
				align-items: center; 
				justify-content: center; 
				color: white;">
				
				<!-- 1. Haupt-Hintergrundbild -->
				<img src="lokal.webp" style="
					position: absolute; 
					top: 0;
					left: 0;
					width: 100%; 
					height: 100%; 
					object-fit: cover; 
					z-index: 1;">
					
				<!-- 2. Dunkler Schleier -->
				<div style="position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.3); z-index: 1.5; pointer-events: none;"></div>

				 <!-- 3. Mini-Container f√ºr Luftbild + Punkt (B√ºndig unten rechts) -->
				<!--<a href="https://www.google.com/maps/search/?api=1&destination=46.6171,10.6948" -->
				<!--<a href="https://www.google.com/maps/place/46%C2%B037'01.6%22N+10%C2%B041'41.3%22E(Pizzeria+St.+Sisinius)/@46.6171,10.6948,18z?entry=ttu"-->
				

				<!-- 4. Text-Inhalt -->
				<div style="position: relative; z-index: 2; text-align: center; text-shadow: 2px 2px 8px rgba(0,0,0,0.8); padding: 0 20px;">
					<h2 style="font-size: 2.5rem; margin-bottom: 10px; text-transform: none;">
						${lang === 'DE' ? 'Willkommen bei Pizzeria Pub St. Sisinius' : 'Benvenuti alla Pizzeria Pub St. Sisinius'}
					</h2>
					<p style="font-size: 1.5rem; font-weight: 500;">
						${lang === 'DE' ? 'Pizza, Cocktails und Live-Sport' : 'Pizza, cocktail e sport dal vivo'}
					</p>
				</div>
			</div>
			<!--<a href="https://www.google.com/maps/place/Pizzeria+Pub+St.+Sisinius/@46.6224613,10.693687,18.58z/data=!4m6!3m5!1s0x4782e0627ab612c3:0xca96466506f0d033!8m2!3d46.6224479!4d10.6940889!16s%2Fg%2F11bbsz_x5t?entry=ttu"
							   target="_blank" -->
		<div class="container">
			<div class="about-section">
				<img src="pizza.webp" alt="Pizza" class="about-image">
				<div class="about-text">
					${lang === 'DE' ? 
						'<p>Genie√üen Sie unsere frische Pizza aus dem Holzofen in vielen Varianten sowie Cocktails und erfrischende Getr√§nke.</p>' +
						'<p>Ob entspanntes Essen, ein Treffen mit Freunden oder ein Abend mit Live-Sport ‚Äì bei uns sind Sie richtig. Wir √ºbertragen die wichtigsten Sportereignisse und bieten verschiedene Events und Specials f√ºr beste Stimmung und Abwechslung in der Pizzeria St. Sisinius.</p>' +
						'<p><strong>Wir freuen uns auf Ihren Besuch!</strong></p>' 
						: 
						'<p>Benvenuti alla Pizzeria Pub St. Sisinius a Lasa! Serviamo pizze cotte nel tradizionale forno a legna, preparata con ingredienti freschi e molta cura per i dettagli.</p>' +
						'<p>Godetevi le nostre deliziose pizze in un\'atmosfera accogliente mentre seguite i pi√π importanti eventi sportivi sui nostri schermi.</p>' +
						'<p><strong>Non vediamo l\'ora di darvi il benvenuto!</strong></p>'
					}
				</div>
			</div> <!-- Ende about-section -->

			<!-- Dieser Container sorgt daf√ºr, dass Kontakt und √ñffnungszeiten nebeneinander stehen -->
			<div class="info-section-compact" style="display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;">
				
					
					
					
					<!-- KONTAKT KARTE -->
				<div class="contact-card-large" style="position: relative; overflow: hidden; min-height: 180px;">
				
					<!-- Kopfzeile: Icon, Titel und das Bild rechts daneben -->
					<div style="display: flex; justify-content: space-between; align-items: flex-start; padding: 15px;">
							
						<div style="flex: 1;">
							<div class="contact-icon">üìû</div>
							<h3 style="color:var(--red); margin: 5px 0;">${lang === 'DE' ? 'Kontakt' : 'Contatto'}</h3>
							
							<a href="tel:+393898334004" class="phone-number" style="display: block; font-weight: bold; text-decoration: none; font-size: 1.2rem;">
								+39 389 833 4004
							</a>
							<p style="font-size: 0.85rem; margin-top: 8px; line-height: 1.3; max-width: 180px; font-weight: bold;">
								${lang === 'DE' ? 'Reservierung und Pizza zum Abholen' : 'Prenotazioni e pizza da asporto'}
							</p>
						</div>

					
						<!-- Rechte Spalte: Alles exakt rechtsb√ºndig untereinander -->
						<div style="display: flex; flex-direction: column; align-items: flex-end; margin-left: auto; width: 110px;">



					
							<!-- 1. GOOGLE MAPS WIDGET (Dein bisheriges Design) -->
							<!-- Das Orthofoto: Jetzt oben rechts neben dem Text -->
							<a href="https://www.google.com/maps/place/Pizzeria+Pub+St.+Sisinius/@46.6224613,10.693687,18.58z/data=!4m6!3m5!1s0x4782e0627ab612c3:0xca96466506f0d033!8m2!3d46.6224479!4d10.6940889!16s%2Fg%2F11bbsz_x5t?entry=ttu"
								target="_blank" 
							   style="text-decoration: none; display: block; cursor: pointer; margin-bottom: 0px; width: 110px;">
								
								<div style="width: 110px; background: white; border: 2px solid white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.15); display: flex; flex-direction: column;">
									<div style="position: relative; width: 110px; height: 90px;">
										<img src="orthofoto.jpg" style="width: 100%; height: 100%; object-fit: cover; display: block;">
										<div style="position: absolute; top: 65%; left: 40%; transform: translate(-50%, -100%); font-size: 20px;">üìç</div>
									</div>
									<div style="background: #4285F4; color: white; text-align: center; padding: 5px 2px; font-family: Arial, sans-serif; font-size: 10px; font-weight: bold; text-transform: uppercase; line-height: 1.2;">
										${lang === 'DE' ? 'KARTE<br>√ñFFNEN' : 'APRI<br>MAPPA'}
									</div>
								</div>
							</a>
							<!-- 3. QUELLENNACHWEIS (Dezent & Rechtsb√ºndig f√ºr S√ºdtirol) -->
							<p style="font-size: 8px; color: #999; margin: 0 0 15px 0; text-align: right; line-height: 1.1; width: 110px; padding-right: 2px;">
								¬© Prov. BZ - CC BY 4.0<br>
								<span style="font-size: 7px;">Geoportal S√ºdtirol</span>
							</p>
							 <!-- 1. INSTAGRAM BUTTON -->
							<a href="https://www.instagram.com/stsisinius
"
							   target="_blank" 
							   style="text-decoration: none; display: flex; align-items: center; justify-content: center; width: 100px; background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); color: white; border-radius: 6px; padding: 6px 0; font-family: Arial, sans-serif; font-size: 10px; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.15);">
								<span style="font-size: 12px; margin-right: 5px;">üì∏</span> 
								INSTAGRAM
							</a>
							
							
							<!-- 2. FACEBOOK BUTTON (Rechtsb√ºndig ausgerichtet) -->
							<a href="https://www.facebook.com/61585930843655/"
							   target="_blank" 
							   style="text-decoration: none; display: flex; align-items: center; justify-content: center; width: 100px; background: #1877F2; color: white; border-radius: 6px; padding: 6px 0; font-family: Arial, sans-serif; font-size: 10px; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.15); margin-right: 0; margin-left: auto;">
								<span style="font-size: 14px; margin-right: 5px; font-family: 'Arial Black', sans-serif;">f</span> 
								FACEBOOK
							</a>
							<!-- 3. WHATSAPP GRUPPEN BUTTON -->
							<!--<a href="https://chat.whatsapp.com" 
							   target="_blank" 
							   style="text-decoration: none; display: flex; align-items: center; justify-content: center; width: 100px; background: #25D366; color: white; border-radius: 6px; padding: 6px 0; font-family: Arial, sans-serif; font-size: 10px; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.15); margin-top: 8px; margin-left: auto;">
								<span style="font-size: 14px; margin-right: 5px;">‚úÜ</span> 
								WHATSAPP
							</a>-->
						</div>
					</div>
				</div>


				<!-- √ñFFNUNGSZEITEN KARTE -->
				<div class="hours-card-large" style="flex: 1; min-width: 300px;">
					<div class="hours-icon">üïê</div>
					<h3 style="color:var(--red)">${lang === 'DE' ? '√ñffnungszeiten' : 'Orari di apertura'}</h3>
					<div class="hours-list">
						${(data.start && data.start.zeiten && data.start.zeiten.length > 0) ? 
							data.start.zeiten.map((z, idx) => `
								<div class="hours-item" style="display: flex; flex-direction: column; margin-bottom: 15px; border-bottom: ${editMode ? '1px dashed #ccc' : 'none'}; padding-bottom: ${editMode ? '10px' : '0'};">
									<!-- Anzeige der Zeit -->
									<div style="display: flex; justify-content: space-between; width: 100%;">
										<span class="tag-spalte" style="font-weight: bold;">
											${lang === 'DE' ? (z.tagDE || z.tag || '') : (z.tagIT || z.tag || '')}
										</span> 
										<span class="zeit-spalte">${z.zeit ? z.zeit.trim() : ''}</span>
									</div>

									<!-- Admin Controls: Nur im EditMode sichtbar -->
									${editMode ? `
									<div class="admin-row-controls" style="display: flex; gap: 5px; margin-top: 8px; justify-content: flex-end;">
										<button onclick="editTimeRow(${idx})" style="background:#ffc107; border:none; border-radius:3px; padding:4px 8px; cursor:pointer; font-size:11px;">‚úèÔ∏è Edit</button>
										<button onclick="moveTimeRow(${idx}, -1)" style="background:#6c757d; color:white; border:none; border-radius:3px; padding:4px 8px; cursor:pointer; font-size:11px;" ${idx === 0 ? 'disabled' : ''}>‚Üë</button>
										<button onclick="moveTimeRow(${idx}, 1)" style="background:#6c757d; color:white; border:none; border-radius:3px; padding:4px 8px; cursor:pointer; font-size:11px;" ${idx === data.start.zeiten.length - 1 ? 'disabled' : ''}>‚Üì</button>
										<button onclick="deleteTimeRow(${idx})" style="background:#dc3545; color:white; border:none; border-radius:3px; padding:4px 8px; cursor:pointer; font-size:11px;">üóëÔ∏è</button>
									</div>
									` : ''}
								</div>
							`).join('') 
							: `<p>${lang === 'DE' ? 'Keine Zeiten hinterlegt.' : 'Nessun orario inserito.'}</p>`
						}
					</div>
				</div>
			</div> <!-- Ende info-section-compact -->
		</div> <!-- Ende container -->
		<!--</div>-->
		
		${editMode ? `
			<div style="text-align:center; margin:20px;">
				<button class="btn-ctrl" onclick="addTimeRow()" style="background-color: var(--red); color: white; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
					+ Neue √ñffnungszeit hinzuf√ºgen
				</button>
			</div> 
			
			
		
			<div class="admin-box" style="margin: 30px auto; padding: 20px; border: 3px solid var(--red); border-radius: 12px; background: #fff; max-width: 600px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
				<h3 style="color:var(--red); margin-top: 0;">üì¢ Admin: Info-Popup & Events</h3>
				
				<!-- Status -->
				<label style="display:block; margin-bottom:15px; font-weight:bold; cursor:pointer; background: #f9f9f9; padding: 10px; border-radius: 6px;">
					<input type="checkbox" id="edit-notice-active" ${data.notice && data.notice.active ? 'checked' : ''}> 
					Popup auf Startseite AKTIVIEREN
				</label>

                 <!-- HIER DIE NEUEN TITEL-FELDER EINF√úGEN -->
				<p><strong>√úberschrift (DE):</strong></p>
				<input type="text" id="edit-notice-title-de" 
					   value="${(data.notice && data.notice.titleDE) ? data.notice.titleDE : 'Wichtige Info'}" 
					   style="width:100%; padding: 8px; margin-bottom:15px; border: 1px solid #ccc; border-radius: 4px;">

				<p><strong>Titolo (IT):</strong></p>
				<input type="text" id="edit-notice-title-it" 
					   value="${(data.notice && data.notice.titleIT) ? data.notice.titleIT : 'Info importante'}" 
					   style="width:100%; padding: 8px; margin-bottom:15px; border: 1px solid #ccc; border-radius: 4px;">

			    <!-- Bild-Upload f√ºr das POPUP -->
				<div style="margin-bottom: 15px;">
					<p style="margin-bottom: 5px;"><strong>Event-Bild / Foto (JPG/PNG):</strong></p>
					
					<input type="file" id="file-input-notice" accept="image/*" onchange="encodeNoticeImage(this)" style="width: 100%;">
					
					<!-- Hidden Input f√ºr Base64 -->
					<input type="hidden" id="inImgBase64Notice" value="${(data.notice && data.notice.img) ? data.notice.img : ''}">
					
					<div style="margin-top: 10px; text-align: center; background: #eee; border-radius: 8px; padding: 10px; position: relative;">
						
						<!-- L√∂sch-Button (wird nur angezeigt, wenn ein Bild da ist) -->
						<button onclick="removeNoticeImage()" id="btn-remove-notice" 
								style="display: ${(data.notice && data.notice.img) ? 'block' : 'none'}; 
								position: absolute; top: 5px; right: 5px; background: #dc3545; color: white; 
								border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer; font-size: 12px;">
							Bild l√∂schen üóëÔ∏è
						</button>

						<img id="img-preview-notice" src="${(data.notice && data.notice.img) ? data.notice.img : ''}" 
							 style="max-width: 100%; max-height: 150px; display: ${(data.notice && data.notice.img) ? 'inline-block' : 'none'}; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
						
						<p id="no-img-text-notice" style="display: ${(data.notice && data.notice.img) ? 'none' : 'block'}; color: #999; font-size: 0.9rem;">
							Kein Bild ausgew√§hlt
						</p>
					</div>
				</div>

							
				

				<!-- Nachrichtentext (vorhanden) -->
				<p><strong>Nachricht (Deutsch):</strong></p>
				<textarea id="edit-notice-de" style="width:100%; height:70px; margin-bottom:10px; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">${(data.notice && data.notice.textDE) ? data.notice.textDE : ''}</textarea>
				
				<p><strong>Messaggio (Italiano):</strong></p>
				<textarea id="edit-notice-it" style="width:100%; height:70px; margin-bottom:20px; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">${(data.notice && data.notice.textIT) ? data.notice.textIT : ''}</textarea>
				
				<!-- Speichern Button -->
				<button onclick="saveNoticeSettings()" style="width:100%; background:#28a745; color:white; padding:15px; border:none; border-radius:8px; cursor:pointer; font-weight:bold; font-size:1.1rem; transition: background 0.3s;">
					√Ñnderungen in Datenbank speichern
				</button>
			</div>
	
		`: ''}
		`;		
		// Ruft die Funktion auf und √ºbergibt die ben√∂tigten Daten
        renderNoticePopup(data, lang, area);
        
		return;  //bricht render() ab
		
    }
	
	//---------------------------------------------------------------
	
    // 2. ANDERE SEITEN ALS STARTSEITE 
	//=====================================
    

    if (!data[currentTab]) {
        area.innerHTML = '<p>Lade Daten...</p>';
        return;
    }

    // 2.2 LISTEN RENDERING
    area.className = (currentTab === 'pizzas') ? 'grid-mode' : 'list-mode';
    // area.innerHTML = ''; // Falls du oben am Anfang der Funktion schon leerst, bleibt das auskommentiert

    // --- FALL 1: PIZZAS ---
    if (currentTab === 'pizzas') {
        area.innerHTML += `
            <div style="grid-column: 1 / -1; width: 100%; text-align: left; margin-bottom: 0px;">
                <h1 style="color: black; margin: 0; padding: 0; font-size: 1.5rem;">
                    ${lang === 'DE' ? 'Unsere Pizzakarte' : 'Il Nostro Menu Pizza'}
                </h1>
            </div>
        `;
        
        const kats = [
            { id: 'pizza', de: 'Pizza', it: 'Pizza' },
            { id: 'bianche', de: 'Pizza Bianca', it: 'Pizze Bianche' },
            { id: 'kinder', de: 'Kinderpizza', it: 'Pizze per bambini' },
			{ id: 'extras', de: 'Extras', it: 'Extra' } // <--- Das hier hinzuf√ºgen!
        ];

        kats.forEach(kat => {
            // Erst filtern...
            const filtered = data.pizzas.filter(p => (p.cat || 'pizza') === kat.id);
            
            // ...dann pr√ºfen und anzeigen
            if (filtered.length > 0) {
                area.innerHTML += `
                    <div style="grid-column: 1 / -1; width: 100%; margin-top: 5px; border-bottom: 3px solid var(--red);">
                        <h2 style="margin: 0px 0; padding: 10px 0; color: var(--red);">${lang === 'DE' ? kat.de : kat.it}</h2>
                    </div>`;
                
                filtered.forEach(item => {
                    const realIdx = data.pizzas.findIndex(p => p === item);
                    area.innerHTML += renderPizzaOrEvent(item, realIdx, true);
                });
            }
        });
		renderNoticePopup(data, lang, area);
    } 
    // --- FALL 2: TV & EVENTS ---
    else {
        // √úBERSCHRIFT NUR EINMAL (vor der Schleife)
        const title = currentTab === 'tv' ? (lang === 'DE' ? 'TV-Sport' : 'TV-Sport') : (lang === 'DE' ? 'Events' : 'Eventi');
        area.innerHTML += `
            <div style="grid-column: 1 / -1; width: 100%; text-align: left; margin-bottom: 0;">
                <h1 style="color: black; margin: 0; padding: 0; font-size: 1.5rem;">${title}</h1>
            </div>
            <div style="grid-column: 1 / -1; width: 100%; margin-top: 5px; border-bottom: 2px solid var(--red); margin-bottom: 20px;"></div>
        `;



		data[currentTab].forEach((item, idx) => {
			if (currentTab === 'tv') {
				// 1. Wir holen den Text direkt aus descDE (wo dein Datum steht)
				const textDE = item.descDE || '';
				
				// 2. Wir rufen die Funktion auf, die bei den Events schon funktioniert
				// Wir machen das AUSSERHALB des Strings, um Fehler zu vermeiden
				const textIT = (typeof translateDate === 'function') ? translateDate(textDE) : textDE;

				area.innerHTML += `
					<div class="event-card">
						<div class="event-date">
							<!-- HIER ENTSCHEIDET DER BROWSER: DE -> Original, IT -> √úbersetzung -->
							${lang === 'DE' ? textDE : textIT}
						</div> 
						
						<hr class="event-line">
						<div class="event-grid">
							<div class="event-time">${item.right || ''}</div>
							<div class="event-teams">${lang === 'DE' ? (item.nameDE || '') : (item.nameIT || '')}</div>
							<div class="event-league">${item.cat || 'LIVE'}</div>
						</div>
						${getAdminButtonsHtml(idx)}
					</div>`;
			} else {
				// Events nutzen renderPizzaOrEvent, wo es ja schon klappt
				area.innerHTML += renderPizzaOrEvent(item, idx, false);
			}
		});
				
		// Ruft die Funktion auf und √ºbergibt die ben√∂tigten Daten
		renderNoticePopup(data, lang, area);
		
	} // <--- Ende des else-Blocks (f√ºr TV/Events)
	
} // <--- Ende der render() Funktion


// Hilfsfunktion, um doppelten Code zu vermeiden
// Hilfsfunktion mit automatischer Wochentags-√úbersetzung f√ºr Laas
function renderPizzaOrEvent(item, idx, isPizza) {    
    let displayRight = item.right || '';
    
    // (Deine Logik...)

    // KEIN Semikolon direkt nach return!
    return `
	<div class="entry">
		${item.img ? `<img src="${item.img}" class="item-img" alt="Bild">` : ''}
		
		<div class="entry-content">
			<div class="entry-header">
				<span style="font-weight: bold; font-size: 1.1rem;">
					${lang === 'DE' ? (item.nameDE || '') : (item.nameIT || '')}
				</span>
				
				<span class="price" style="color: var(--red); font-weight: bold; white-space: nowrap;">
					${displayRight}${isPizza ? ' ‚Ç¨' : ''}
				</span>
			</div>

			<div class="desc" style="font-size: 0.9rem; color: #555; font-style: italic; margin: 10px 0; flex-grow: 1;">
				${lang === 'DE' ? (item.descDE || '') : (item.descIT || '')}
			</div>

			${typeof getAdminButtonsHtml === 'function' ? getAdminButtonsHtml(idx) : ''}
		</div>
	</div>
    `; // Hier am Ende ist das Semikolon richtig.
}


function translateDate(str) {
    if (!str || lang === 'DE') return str;

    // Lange W√∂rter und kurze Abk√ºrzungen in einem Objekt mapping
    const mapping = {
        "Montag": "Luned√¨", "Dienstag": "Marted√¨", "Mittwoch": "Mercoled√¨", 
        "Donnerstag": "Gioved√¨", "Freitag": "Venerd√¨", "Samstag": "Sabato", "Sonntag": "Domenica",
        "Mo": "Lun", "Di": "Mar", "Mi": "Mer", "Do": "Gio", "Fr": "Ven", "Sa": "Sab", "So": "Dom"
    };

    let res = str;
    // Wir sortieren die Keys nach L√§nge (l√§ngste zuerst), um Teil-Fehler zu vermeiden
    Object.keys(mapping).sort((a, b) => b.length - a.length).forEach(deTag => {
        // \b stellt sicher, dass nur das GANZE Wort/K√ºrzel ersetzt wird
        // Damit wird aus "Sa" in "Sabato" kein "Sabbato"!
        const regex = new RegExp("\\b" + deTag + "\\b", "gi");
        res = res.replace(regex, mapping[deTag]);
    });
    
    return res;
}

// HILFSFUNKTION (Benannt!)  EDIT L√ñSCHEN, VERSCHIEBEN
function getAdminButtonsHtml(idx) {
    if (!editMode) return '';
    return `
        <div class="btn-row admin-only" style="display: flex !important; margin-top:10px;">           
			 <!-- Pfeile NUR im Pizza-Tab anzeigen -->
            ${currentTab === 'pizzas' ? `
			  <button class="btn-ctrl" onclick="move(${idx}, -1)">‚ñ≤</button>
              <button class="btn-ctrl" onclick="move(${idx}, 1)">‚ñº</button>
            ` : ''}			
			<button class="btn-ctrl" style="background:#ffa000" onclick="editItem(${idx})">‚úé</button>
            <button class="btn-ctrl" style="background:#d32f2f" onclick="remove(${idx})">‚úñ</button>
        </div>`;
}

// 1. Neue Zeile hinzuf√ºgen
/*async function addTimeRow() {
    const tDE = prompt("Tag auf DEUTSCH (z.B. Montag):", "Montag");
    if (!tDE) return;
    const tIT = prompt("Giorno in ITALIANO (p.es. Luned√¨):", "Luned√¨");
    const uhr = prompt("Uhrzeit (Nutze % f√ºr Leerzeichen, z.B. 17:00-22:00):", "17:00-22:00");

    const neueZeile = {
        tagDE: tDE,
        tagIT: tIT,
        zeit: uhr
    };

    if (!data.start.zeiten) data.start.zeiten = [];
    data.start.zeiten.push(neueZeile);
    
    await save(); // Deine save() Funktion zum Server
    render();
}*/

// Hilfsfunktion zum Speichern der gesamten Daten
async function saveAllData() {
    try {
        const response = await fetch('/api/data?pw=leon2208', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        if (response.ok) { location.reload(); } 
        else { alert("Fehler beim Speichern!"); }
    } catch (err) { console.error(err); }
}

// Zeile l√∂schen
function deleteTimeRow(index) {
    if(confirm(lang === 'DE' ? "Zeile wirklich l√∂schen?" : "Eliminare riga?")) {
        data.start.zeiten.splice(index, 1);
        saveAllData();
    }
}

// Zeile verschieben (hoch/runter)
function moveTimeRow(index, direction) {
    const targetIndex = index + direction;
    if (targetIndex < 0 || targetIndex >= data.start.zeiten.length) return;
    
    const element = data.start.zeiten.splice(index, 1)[0];
    data.start.zeiten.splice(targetIndex, 0, element);
    saveAllData();
}

// Zeile editieren
function editTimeRow(index) {
    const z = data.start.zeiten[index];
    const newTagDE = prompt("Tag (DE):", z.tagDE || z.tag);
    const newTagIT = prompt("Giorno (IT):", z.tagIT || z.tag);
    const newZeit = prompt("Zeit / Orario:", z.zeit);
    
    if (newTagDE !== null && newTagIT !== null && newZeit !== null) {
        data.start.zeiten[index] = {
            tagDE: newTagDE,
            tagIT: newTagIT,
            zeit: newZeit
        };
        saveAllData();
    }
}

// Neue Zeile hinzuf√ºgen (Erweiterung deiner bestehenden Funktion)
function addTimeRow() {
    if (!data.start.zeiten) data.start.zeiten = [];
    data.start.zeiten.push({ tagDE: "Neu", tagIT: "Nuovo", zeit: "00:00 - 00:00" });
    saveAllData();
}


 
//√ñffnungszeiten
//=========================================
// 2. In MongoDB speichern
async function saveHoursToDB(newArray) {
    const updatedData = {
        ...data,
        type: "main_data",
        start: { 
            ...data.start, 
            zeiten: newArray 
        }
    };

    try {
        const response = await fetch('/api/data?pw=leon2208', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(updatedData)
        });

        if (response.ok) {
            location.reload(); // Seite in Laas neu laden
        } else {
            alert("Fehler beim Speichern! Status: " + response.status);
        }
    } catch (e) {
        console.error("Netzwerkfehler:", e);
    }
}


// ITEM HINZUF√úGEN
//===================================================
    async function addItem() {
    // 1. Werte aus den Feldern holen
    const newItem = {
        nameDE: document.getElementById('inNameDE').value,
        nameIT: document.getElementById('inNameIT').value,
        descDE: document.getElementById('inDescDE').value,
        descIT: document.getElementById('inDescIT').value,
        right: document.getElementById('inRight').value,
        img: document.getElementById('inImgBase64').value || ""
		//img: document.getElementById('inImg') ? document.getElementById('inImg').value : ""
    };

   // WICHTIG: Hier wird die Kategorie ausgelesen
    if (currentTab === 'pizzas' || currentTab === 'tv') {
        const catDropdown = document.getElementById('inCat');
        if (catDropdown) {
            newItem.cat = catDropdown.value; // Nimmt 'pizza', 'bianche' oder 'kinder'
        } else {
			if (currentTab === 'pizzas'){
              newItem.cat = 'pizza'; // Sicherheits-Fallback
			}
			else{
			  newItem.cat = 'LIVE'; // Sicherheits-Fallback
			}
				
        }
    }


    // Sicherheitscheck: Falls Name leer ist
    if (!newItem.nameDE && currentTab !== 'start') {
        alert("Bitte Namen eingeben!");
        return;
    }

    // 2. ENTSCHEIDUNG: Bearbeiten oder Neu?
    if (editIndex !== null) {
        // BEARBEITEN: Bestehenden Index √ºberschreiben
        data[currentTab][editIndex] = newItem;
        console.log("Eintrag an Position " + editIndex + " bearbeitet.");
        editIndex = null; // WICHTIG: Index nach Erfolg zur√ºcksetzen!
    } else {
        // NEU: Nur wenn kein editIndex gesetzt ist, wird gepusht
        if (currentTab === 'start') {
            data.start = newItem; // [newItem]; // Bei Start meist nur ein Eintrag
        } else {
            data[currentTab].push(newItem);
            console.log("Neuer Eintrag am Ende hinzugef√ºgt.");
        }
    }

    // 3. SYNCHRONISATION MIT SERVER
    try {
        const res = await fetch('/api/data?pw=leon2208', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        if (res.ok) {
            // Felder leeren f√ºr n√§chsten Eintrag
            clearFields();
            alert("Erfolgreich gespeichert!");
            render();
        }
    } catch (e) {
        alert("Fehler beim Speichern!");
    }
}


// √ñffnungszeiten
//============================
async function editStartInfo() {
    // 1. Neue Zeiten vom User abfragen
    const neueZeiten = prompt("Geben Sie die neuen √ñffnungszeiten ein (z.B. Di-Do 16:00-00:00, Fr-Sa...):");
    
    if (neueZeiten) {
        // 2. Das komplette Datenobjekt vorbereiten (muss zu deiner MongoDB Struktur passen)
        const updatedData = {
            ...data, // Beh√§lt alle bestehenden Daten (Pizzas, TV etc.) bei
            type: "main_data",
            start: {
                ...data.start,
                oeffnungszeiten: neueZeiten // Hier wird der neue Wert gesetzt
            }
        };

        // 3. An deine bestehende API senden (Passwort in der URL wegen deiner Route)
        try {
            const response = await fetch('/api/data?pw=leon2208', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(updatedData)
            });

            if (response.ok) {
                alert("√ñffnungszeiten aktualisiert!");
                location.reload();
            } else {
                alert("Fehler beim Speichern. Passwort korrekt?");
            }
        } catch (err) {
            console.error(err);
            alert("Verbindung zum Server fehlgeschlagen.");
        }
    }
}



    

    
	// Hilfsfunktion zum Leeren der Felder
	function clearFields() {
		document.getElementById('inNameDE').value = "";
		document.getElementById('inNameIT').value = "";
		document.getElementById('inDescDE').value = "";
		document.getElementById('inDescIT').value = "";
		document.getElementById('inRight').value = "";
		if(document.getElementById('inImg')) document.getElementById('inImg').value = "";
		const title = document.getElementById('admin-title');
		if(title) title.innerText = "Neuen Eintrag hinzuf√ºgen";
	}
	
    /*function move(index, dir) {
        const list = data[currentTab];
        if (index + dir >= 0 && index + dir < list.length) {
            [list[index], list[index + dir]] = [list[index + dir], list[index]];
            save();
        }
    }*/
	
async function move(index, direction) {
    const items = data[currentTab];
    const targetIndex = index + direction;

    // 1. Abbruch, wenn man √ºber den Anfang oder das Ende hinaus will
    if (targetIndex < 0 || targetIndex >= items.length) return;

    // 2. KATEGORIE-CHECK (NUR f√ºr Pizzen!)
    if (currentTab === 'pizzas') {
        const currentCat = items[index].cat || 'pizza';
        const targetCat = items[targetIndex].cat || 'pizza';
        
        // Wenn die Kategorien unterschiedlich sind (z.B. Pizza -> Bianche), Tausch stoppen
        if (currentCat !== targetCat) {
            console.log("Verschieben nur innerhalb der Pizza-Kategorie erlaubt.");
            return; 
        }
    } 
    // HINWEIS: F√ºr 'tv' und 'events' gibt es hier kein 'if', 
    // daher wird dort IMMER getauscht, egal was in 'cat' steht.

    // 3. Tausch im Array (Destructuring-Methode)
    [items[index], items[targetIndex]] = [items[targetIndex], items[index]];

    // 4. In die MongoDB Atlas Cloud speichern & Ansicht erneuern
    await save();
    render(); 
}
  
	
	
	

    function remove(idx) {
        if(confirm('L√∂schen / Eliminare?')) { data[currentTab].splice(idx, 1); render();save(); }
    }

    function editStart() {
        const txt = prompt("Text eingeben / Inserire testo:", lang === 'DE' ? data.start.textDE : data.start.textIT);
        if(txt !== null) {
            if(lang === 'DE') data.start.textDE = txt; else data.start.textIT = txt;
            save();
        }
    }

	function encodeImageFileAsURL(element) {
		const file = element.files[0];
		if (!file) return;

		const reader = new FileReader();
		reader.onload = function(e) {
			const img = new Image();
			img.onload = function() {
				// 1. Leinwand erstellen
				const canvas = document.createElement('canvas');
				const MAX_WIDTH = 800; // Maximale Breite f√ºr die Pizzeria-Webseite
				
				let width = img.width;
				let height = img.height;

				// 2. Proportionen berechnen
				if (width > MAX_WIDTH) {
					height *= MAX_WIDTH / width;
					width = MAX_WIDTH;
				}

				canvas.width = width;
				canvas.height = height;

				// 3. Bild auf Leinwand zeichnen (verkleinern)
				const ctx = canvas.getContext('2d');
				ctx.drawImage(img, 0, 0, width, height);

				// 4. Als komprimiertes JPG exportieren (Qualit√§t 0.7 = 70%)
				const compressedBase64 = canvas.toDataURL('image/jpeg', 0.7);

				// 5. In das versteckte Feld und die Vorschau schreiben
				document.getElementById('inImgBase64').value = compressedBase64;
				
				const preview = document.getElementById('img-preview');
				if (preview) {
					preview.src = compressedBase64;
					preview.style.display = 'block';
				}
				if (document.getElementById('no-img-text')) document.getElementById('no-img-text').style.display = 'none';
				
				console.log("Bild f√ºr St. Sisinius optimiert: " + Math.round(compressedBase64.length / 1024) + " KB");
			};
			img.src = e.target.result;
		};
		reader.readAsDataURL(file);
	}
		
	

    load();
	
	
	async function importPizzeriaDataComplete() {
    const fullList = [
        { n: "Margherita", p: "7.50", dDE: "Tomaten, Fior di Latte, Basilikum", dIT: "Pomodoro, fior di latte, basilico", c: "pizza" },
        { n: "Marinara", p: "6.50", dDE: "Tomaten, Knoblauch, Oliven√∂l", dIT: "Pomodoro, aglio, olio d¬¥oliva", c: "pizza" },
        { n: "Prosciutto", p: "9.00", dDE: "Tomaten, Fior di Latte, Schinken", dIT: "Pomodoro, fior di latte, prosciutto cotto", c: "pizza" },
        { n: "Prosciutto e funghi", p: "9.50", dDE: "Tomaten, Fior di Latte, Schinken, Champignon", dIT: "Pomodoro, fior di latte, prosciutto cotto, champignon", c: "pizza" },
        { n: "Capricciosa", p: "10.00", dDE: "Tomaten, Fior di Latte, Schinken, Champignon, Artischocken", dIT: "Pomodoro, fior di latte, prosciutto, champignon, carciofi", c: "pizza" },
        { n: "Quattro stagioni", p: "10.50", dDE: "Tomaten, Fior di Latte, Schinken, Champignon, Artischocken, Oliven", dIT: "Pomodoro, fior di latte, prosciutto, champignon, carciofi, olive", c: "pizza" },
        { n: "Diavola", p: "10.00", dDE: "Tomaten, Fior di Latte, scharfe Salami, Lombardi", dIT: "Pomodoro, fior di latte, salame piccante, lombardi", c: "pizza" },
        { n: "Siciliana", p: "10.00", dDE: "Tomaten, Fior di latte, Oliven, Kapern, Sardellen", dIT: "Pomodoro, fior di latte, olive, capperi, acciughe", c: "pizza" },
        { n: "Quattro formaggi", p: "11.50", dDE: "Tomaten, Fior di latte, Bufala, Gorgonzola, Parmesan", dIT: "Pomodoro, fior di latte, bufala, gorgonzola, parmigiano", c: "pizza" },
        { n: "Meeresfr√ºchte", p: "12.50", dDE: "Tomaten, Fior di latte, Meeresfr√ºchte, Knoblauch, Petersilie", dIT: "Pomodoro, fior di latte, frutti di mare, aglio, prezzemolo", c: "pizza" },
        { n: "Tonno", p: "9.50", dDE: "Tomaten, Fior di latte, Thunfisch, Zwiebel", dIT: "Pomodoro, fior di latte, tonno, cipolla", c: "pizza" },
        { n: "Garnelen", p: "13.00", dDE: "Tomaten, Fior di latte, Garnelen, Cocktailtomaten, Knoblauch", dIT: "Pomodoro, fior di latte, gamberi, pomodorini, aglio", c: "pizza" },
        { n: "Lachs", p: "12.50", dDE: "Tomaten, Fior di latte, Lachs, Zucchini", dIT: "Pomodoro, fior di latte, salmone, zucchine", c: "pizza" },
        { n: "Calzone", p: "10.50", dDE: "Tomaten, Fior di latte, Schinken, Champignon", dIT: "Pomodoro, fior di latte, prosciutto, champignon", c: "pizza" },
        { n: "Bauern", p: "10.00", dDE: "Tomaten, Fior di latte, Speck, Zwiebel, Knoblauch", dIT: "Pomodoro, fior di latte, speck, cipolla, aglio", c: "pizza" },
        { n: "Bufalina", p: "11.50", dDE: "Tomaten, Bufala, Rucola, Cocktailtomaten, Parmesan", dIT: "Pomodoro, bufala, rucola, pomodorini, parmigiano", c: "pizza" },
        { n: "Parma", p: "12.50", dDE: "Tomaten, Fior di latte, Rucola, Cocktailtomaten, Rohschinken, Parmesan", dIT: "Pomodoro, fior di latte, rucola, pomodorini, crudo, parmigiano", c: "pizza" },
        { n: "Gem√ºse", p: "11.00", dDE: "Tomaten, Fior di latte, Gem√ºse, Parmesan, Knoblauch", dIT: "Pomodoro, fior di latte, verdure, parmigiano, aglio", c: "pizza" },
        { n: "Vegana", p: "9.50", dDE: "Tomaten, Gem√ºse, Knoblauch, Oliven√∂l", dIT: "Pomodoro, verdura, aglio, olio d‚Äôoliva", c: "pizza" },
        { n: "Parmigiana", p: "10.50", dDE: "Tomaten, Fior di latte, Melanzane, Parmesan", dIT: "Pomodoro, fior di latte, melanzane, parmigiano", c: "pizza" },
        { n: "Autunno", p: "11.50", dDE: "Tomaten, Fior di latte, Gorgonzola, Speck, Waln√ºsse", dIT: "Pomodoro, fior di latte, gorgonzola, speck, noci", c: "pizza" },
        { n: "Parnetz", p: "11.50", dDE: "Tomaten, Fior di latte, Speck, Pfifferlinge, Spinat, Knoblauch", dIT: "Pomodoro, fior di latte, speck, finferli, spinaci, aglio", c: "pizza" },
        { n: "Primavera", p: "12.00", dDE: "Tomaten, Bufala, Cocktailtomaten, Basilikumpesto, Ricotta", dIT: "Pomodoro, bufala, pomodorini, pesto alla Genovese, ricotta", c: "pizza" },
        { n: "Rustica", p: "12.00", dDE: "Tomaten, Fior di latte, scharfe Salami, Gorgonzola, Zwiebel, Lombardi", dIT: "Pomodoro, fior di latte, salame piccante, gorgonzola, cipolla, lombardi", c: "pizza" },
        { n: "Sisinius", p: "12.50", dDE: "Tomaten, Fior di latte, scharfe Salami, Zwiebel, Paprika, Pfifferlinge, Ei", dIT: "Pomodoro, fior di latte, salame piccante, cipolla, peperoni, finferli, uova", c: "pizza" },
        { n: "Mediterranea", p: "12.00", dDE: "Tomaten, Fior di latte, Artischocken, Cocktailtomaten, Oliven, Ricotta, Parmesan", dIT: "Pomodoro, fior di latte, carciofi, pomodorini, olive, ricotta, parmigiano", c: "pizza" },
        { n: "Vinschger", p: "13.00", dDE: "Tomaten, Fior di latte, Speck, Zwiebel, Gorgonzola, Pfifferlinge, Parmesan, Knoblauch", dIT: "Pomodoro, fior di latte, speck, cipolla, gorgonzola, finferli, parmigiano, aglio", c: "pizza" },
        { n: "Italia", p: "13.50", dDE: "Tomaten, Fior di latte, Cocktailtomaten, Rohschinken, Burrata, Basilikum", dIT: "Pomodoro, fior di latte, pomodorini, crudo, burrata, basilico", c: "pizza" },

        // --- PIZZA BIANCHE ---
        { n: "Genovese", p: "13.00", dDE: "Basilikumpesto, Fior di latte, Cocktailomaten, Rohschinken, Parmesan", dIT: "Pesto alla genovese, fior di latte, pomodorini, crudo, parmigiano", c: "bianche" },
        { n: "Carbonara", p: "12.00", dDE: "Fior di latte, Speck, Ei, Parmesan, Pfeffer", dIT: "Fior di latte, speck, uova, parmigiano, pepe", c: "bianche" },
        { n: "Superba", p: "12.00", dDE: "Pesto, Fior di latte, Cocktailtomaten, Burrata, Basilikum", dIT: "Pesto, fior di latte, pomodorini, burrata, basilico", c: "bianche" },

        // --- KINDERPIZZA ---
        { n: "Micky Maus", p: "5.50", dDE: "Tomaten, Fior di latte", dIT: "Pomodoro, fior di latte", c: "kinder" },
        { n: "Scooby Doo", p: "6.50", dDE: "Tomaten, Fior di latte, milde Salami, Mais", dIT: "Pomodoro, fior di latte, salame, mais", c: "kinder" },
        { n: "Nemo", p: "7.00", dDE: "Tomate, Fior di latte, 2 Zutaten nach Wahl", dIT: "Pomodoro, fior di latte, 2 condimenti a scelta", c: "kinder" },

        // --- EXTRAS ---
        { n: "Kleine Pizza / pizze piccole", p: "1.50", dDE: "Abzug von:", dIT: "meno:", c: "extras" },
        { n: "Extra Zutaten / aggiunte", p: "4.50", dDE: "max +", dIT: "max +", c: "extras" },
        { n: "Glutenfreier Teig / impasto senza glutine", p: "3.00", dDE: "+", dIT: "+", c: "extras" },
        { n: "Laktosefreie Mozarella / mozzarella senza lattosio", p: "2.00", dDE: "+", dIT: "+", c: "extras" }
    ];

    // Wir nehmen die bestehende Liste (Teil 1) und f√ºgen den Rest hinzu
    const formatted = fullList.map(p => ({
        nameDE: p.n, nameIT: p.n, descDE: p.dDE, descIT: p.dIT, right: p.p, cat: p.c, img: ""
    }));

    data.pizzas = [...data.pizzas, ...formatted]; 

    await save(); 
    alert("Komplette Speisekarte inklusive Extras erfolgreich importiert!");
    location.reload();
}



function parseSisiniusDate(dateStr, timeStr) {
    if (!dateStr) return new Date(2099, 0, 1); 

    try {
        // Sucht nach TT.MM. (2 oder 4 Stellen beim Jahr)
        // Erkennt: 13.02.26, 13.02.2026, Freitag 13.02.26 etc.
        const match = dateStr.match(/(\d{1,2})\.(\d{1,2})\.(\d{2,4})/);
        
        if (match) {
            let day = parseInt(match[1]);
            let month = parseInt(match[2]) - 1; // Monate 0-11
            let year = parseInt(match[3]);

            // Wenn das Jahr nur 2 Stellen hat (z.B. 26), machen wir 2026 daraus
            if (year < 100) year += 2000;

            // Uhrzeit "18:00" oder "18.00" oder "18" finden
            const tMatch = (timeStr || "").match(/(\d{1,2})[:.]?(\d{2})?/);
            const hours = tMatch ? parseInt(tMatch[1]) : 0;
            const minutes = tMatch ? parseInt(tMatch[2] || 0) : 0;

            return new Date(year, month, day, hours, minutes);
        }
    } catch (e) {
        console.error("Format-Fehler in Laas:", e);
    }
    // Falls gar kein Datum gefunden wird, ab nach hinten in der Liste
    return new Date(2099, 0, 1);
}	

function encodeNoticeImage(element) {
    const file = element.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
            const canvas = document.createElement('canvas');
            const MAX_WIDTH = 800; 
            let width = img.width;
            let height = img.height;

            if (width > MAX_WIDTH) {
                height *= MAX_WIDTH / width;
                width = MAX_WIDTH;
            }
            canvas.width = width;
            canvas.height = height;

            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);

            // Komprimieren
            const compressedBase64 = canvas.toDataURL('image/jpeg', 0.7);

            // HIER DIE NEUEN IDs NUTZEN!
            document.getElementById('inImgBase64Notice').value = compressedBase64;
            
            const preview = document.getElementById('img-preview-notice');
            if (preview) {
                preview.src = compressedBase64;
                preview.style.display = 'inline-block';
            }
            if (document.getElementById('no-img-text-notice')) {
                document.getElementById('no-img-text-notice').style.display = 'none';
            }
            
            console.log("Popup-Bild optimiert: " + Math.round(compressedBase64.length / 1024) + " KB");
        };
        img.src = e.target.result;
    };
    reader.readAsDataURL(file);
}


async function saveNoticeSettings___() {
    // 1. Elemente holen
    const activeEl = document.getElementById('edit-notice-active');
    const deEl = document.getElementById('edit-notice-de');
    const itEl = document.getElementById('edit-notice-it');
    const imgEl = document.getElementById('inImgBase64Notice');

    if (!deEl) {
        alert("Fehler: Felder nicht gefunden. Bist du auf dem Start-Tab?");
        return;
    }

    // 2. NUR die Daten im globalen 'data'-Objekt aktualisieren
    data.notice = {
        active: activeEl.checked,
        img: imgEl ? imgEl.value : (data.notice ? data.notice.img : ""),
        textDE: deEl.value,
        textIT: itEl.value
    };

    // 3. Deine vorhandene zentrale save() Funktion nutzen
    await save(); 
    
    // 4. Seite neu laden (wie bei deinen anderen Funktionen)
    alert(lang === 'DE' ? 'Popup-Einstellungen gespeichert!' : 'Impostazioni salvate!');
    location.reload();
}


async function saveNoticeSettings() {
    // 1. Alle Felder pr√§zise auslesen (inklusive der neuen Titel)
    const noticeData = {
        active: document.getElementById('edit-notice-active').checked,
        img: document.getElementById('inImgBase64Notice').value || "",
        titleDE: document.getElementById('edit-notice-title-de').value, // NEU
        titleIT: document.getElementById('edit-notice-title-it').value, // NEU
        textDE: document.getElementById('edit-notice-de').value,
        textIT: document.getElementById('edit-notice-it').value
    };

    // 2. Das globale Daten-Objekt aktualisieren
    // Wir kopieren das bestehende 'data' und f√ºgen 'notice' hinzu
    data.notice = noticeData;

    try {
        // 3. Deine zentrale save() Funktion aufrufen
        // Diese schickt 'data' an /api/data?pw=leon2208
        await save(); 

        // 4. Erfolgsmeldung erzwingen
        alert(lang === 'DE' ? 'Popup erfolgreich gespeichert!' : 'Popup salvato con successo!');
        
        // 5. Seite neu laden, um die √Ñnderungen in der MongoDB zu aktivieren
        location.reload();
    } catch (err) {
        console.error("Fehler beim Speichern:", err);
        alert("Serverfehler: Daten konnten nicht in MongoDB gespeichert werden.");
    }
}

// 3. Die neue Schlie√ü-Funktion (au√üerhalb der render-Funktion platzieren)
/*function closeNoticePopup() {
    // Merken, dass gesehen wurde
    sessionStorage.setItem('noticeSeen', 'true');
    // Aktuelle Sprache speichern
    sessionStorage.setItem('noticeLang', lang); 
    
    const popup = document.getElementById('notice-popup');
    if (popup) popup.remove();
}*/

window.closeNoticePopup = function() {
    const popup = document.getElementById('notice-popup');
    if (popup) {
        popup.remove();
        sessionStorage.setItem('noticeSeen', 'true');
    }
};


function showPopup() {
    if (data.notice && data.notice.active) {
		if (!sessionStorage.getItem('noticeSeen')) {
			area.innerHTML += `
			<div id="notice-popup" style="position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.85); display:flex; align-items:center; justify-content:center; z-index:10000; padding:20px;">
				<div style="background:white; border-radius:15px; max-width:450px; width:100%; max-height:90vh; text-align:center; border:4px solid var(--red); box-shadow: 0 10px 30px rgba(0,0,0,0.5); overflow:hidden; display:flex; flex-direction:column;">
					
					<!-- BILD-BEREICH: max-height auf 40% des Bildschirms begrenzt, damit Button sichtbar bleibt -->
					${data.notice.img ? `
						<div style="width: 100%; max-height: 40vh; background: #f9f9f9; display: flex; align-items: center; justify-content: center; border-bottom: 2px solid #eee; flex-shrink: 0;">
							<img src="${data.notice.img}" 
								 style="max-width: 100%; max-height: 40vh; object-fit: contain; display: block;" 
								 alt="Event">
						</div>
					` : '<div style="font-size: 50px; margin: 20px 0; text-align: center; flex-shrink: 0;">üì¢</div>'}

					<!-- TEXT-BEREICH: Scrollt, falls der Text zu lang f√ºr das Handy ist -->
					<div style="padding:25px; overflow-y: auto; flex-grow: 1;">
						<h2 style="color:var(--red); margin-top:0;">
							${lang === 'DE' 
								? (data.notice.titleDE || 'Wichtige Info') 
								: (data.notice.titleIT || 'Info importante')}
						</h2>
						<p style="font-size:1.1rem; color:#333; font-weight:bold; line-height:1.4;">
							${lang === 'DE' ? data.notice.textDE : data.notice.textIT}
						</p>
						<button onclick="closeNoticePopup()" style="margin-top:20px; background:var(--red); color:white; border:none; padding:12px 30px; border-radius:5px; font-weight:bold; cursor:pointer; text-transform:uppercase; width: 100%;">OK</button>
					</div>
				</div>
			</div>`;
		}
	}
}
function removeNoticeImage() {
    // 1. Hidden Input leeren
    document.getElementById('inImgBase64Notice').value = "";
    
    // 2. File Input leeren
    document.getElementById('file-input-notice').value = "";
    
    // 3. Vorschau-Elemente anpassen
    document.getElementById('img-preview-notice').style.display = "none";
    document.getElementById('img-preview-notice').src = "";
    document.getElementById('no-img-text-notice').style.display = "block";
    
    // 4. L√∂sch-Button verstecken
    document.getElementById('btn-remove-notice').style.display = "none";
}

	
</script>
</body>
</html>

